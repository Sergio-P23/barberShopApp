<ion-menu side="end" contentId="main-content" class="main-header">
  <ion-header>
    <ion-toolbar>
      <ion-title>Menu</ion-title>
    </ion-toolbar>
  </ion-header>
  <ion-content class="ion-padding">
    <a routerLink="/admin/servicios" class="register-link-text">
      <p>servicios</p>
    </a>
    <a routerLink="/admin/barberos" class="register-link-text">
      <p>barberos</p>
    </a>
    <a routerLink="/admin/reservas" class="register-link-text">
      <p>reservas</p>
    </a>
  </ion-content>
  <ion-footer>
    <ion-toolbar>
      <ion-button routerLink="/home" expand="block" class="btn-primary-solid">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Salir
      </ion-button>
    </ion-toolbar>
  </ion-footer>
</ion-menu>

<ion-header class="main-header">
  <ion-toolbar>
    <div class="header-content">
      <img src="../../../assets/logoOne.jpg" alt="Logo de la Barbería" class="header-logo" />

      <div class="header-logged-in-section">
        <ion-menu-button class="menu-button-custom"></ion-menu-button>
      </div>

    </div>
  </ion-toolbar>
</ion-header>

<ion-content class=" main-content" id="main-content">

  <div class="services-section">
    <h2 class="section-title">SERVICIOS</h2>
    <div class="services-grid mt-3">
      <ion-list class="services-grid">
        <div class="service-card mb-3" *ngFor="let servicio of servicios">
          <img src="{{servicio.imagen}}" alt="{{servicio.titulo}}" class="service-image">
          <h2 class="service-title">{{ servicio.titulo }}</h2>
          <p class="service-price">{{ servicio.descripcion }}</p>
          <p class="service-price">{{servicio.precio}}</p>
          <div class="botones">
            <ion-button color="warning" fill="outline" size="small" (click)="abrirModalEditar(servicio)">
              Editar
            </ion-button>
            <ion-button color="danger" fill="outline" size="small" (click)="confirmarBorrado(servicio)">
              Borrar
            </ion-button>
          </div>
        </div>
      </ion-list>
    </div>
  </div>


  <ion-button expand="block" (click)="crear()">Agregar Servicio</ion-button>

  <!-- Modal de Confirmación -->
  <ion-modal [isOpen]="mostrarModalBorrar" cssClass="modal-confirmacion" (didDismiss)="mostrarModalBorrar = false">
    <ng-template>
      <ion-content class="ion-padding modal-content modal-style">
        <h2>¿Estás seguro de borrar el servicio?</h2>
        <p style="margin-top: 50px; font-size: 1.2rem;"><strong>{{ servicioSeleccionado?.titulo }}</strong></p>

        <div class="modal-botones">
          <ion-button expand="block" color="medium" (click)="mostrarModalBorrar = false">Cancelar</ion-button>
          <ion-button expand="block" color="danger" (click)="borrar()">Sí, borrar</ion-button>
        </div>
      </ion-content>
    </ng-template>
  </ion-modal>

  <!-- Modal de editar -->
  <ion-modal [isOpen]="mostrarModalEditar" cssClass="modal-editar" (didDismiss)="mostrarModalEditar = false">
    <ng-template>

      <ion-header class="modal-editar-header">
        <ion-toolbar class="modal-editar-header">
          <ion-title>Editar Servicio</ion-title>
        </ion-toolbar>
      </ion-header>

      <ion-content class="modal-editar-content">
        <form [formGroup]="editarForm" (ngSubmit)="guardarCambios()" > 
          <div class="input-grid" >

            <!-- Campo Título -->
            <ion-item class="editar-input">
              <ion-label position="stacked">Título *</ion-label>
              <ion-input type="text" formControlName="titulo" placeholder="Ingresa el título del servicio"
                [class.ion-invalid]="editarForm.get('titulo')?.invalid && editarForm.get('titulo')?.touched">
              </ion-input>
            </ion-item>
            <ion-note color="danger" *ngIf="editarForm.get('titulo')?.invalid && editarForm.get('titulo')?.touched">
              El título es obligatorio
            </ion-note>

            <!-- Campo Descripción -->
            <ion-item class="editar-input">
              <ion-label position="stacked">Descripción *</ion-label>
              <ion-textarea formControlName="descripcion" placeholder="Describe el servicio..." rows="3"
                [class.ion-invalid]="editarForm.get('descripcion')?.invalid && editarForm.get('descripcion')?.touched">
              </ion-textarea>
            </ion-item>
            <ion-note color="danger"
              *ngIf="editarForm.get('descripcion')?.invalid && editarForm.get('descripcion')?.touched">
              La descripción es obligatoria
            </ion-note>

            <!-- Campo Precio -->
            <ion-item class="editar-input">
              <ion-label position="stacked">Precio ($) *</ion-label>
              <ion-input type="text" formControlName="precio" placeholder="0" min="0" step="1"
                [class.ion-invalid]="editarForm.get('precio')?.invalid && editarForm.get('precio')?.touched">
              </ion-input>
            </ion-item>
            <ion-note color="danger" *ngIf="editarForm.get('precio')?.invalid && editarForm.get('precio')?.touched">
              <span *ngIf="editarForm.get('precio')?.errors?.['required']">El precio es obligatorio</span>
              <span *ngIf="editarForm.get('precio')?.errors?.['min']">El precio debe ser mayor a 0</span>
            </ion-note>

            <!-- Campo Imagen -->
            <ion-item class="editar-input">
              <ion-label position="stacked">Imagen del servicio</ion-label>
              <input type="file" accept="image/*" (change)="onFileSelected($event)" #fileInput
                style="margin-top: 10px;">
            </ion-item>

            <!-- Preview de imagen actual o nueva -->
            <div *ngIf="imagenPreview || servicioActual?.imagen" class="image-preview">
              <img [src]="imagenPreview || servicioActual?.imagen" alt="Preview"
                style="width: 100%; max-width: 200px; height: 150px; object-fit: cover; border-radius: 8px; margin-top: 10px;">
              <ion-button fill="clear" color="danger" size="small" (click)="eliminarImagen()">
                <ion-icon name="trash" slot="start"></ion-icon>
                Eliminar imagen
              </ion-button>
            </div>

            <!-- Botones del formulario -->
            <div class="modal-editar-botones">
              <ion-button expand="block" color="success" type="submit" [disabled]="editarForm.invalid || guardando">
                <ion-icon name="save" slot="start"></ion-icon>
                <span *ngIf="!guardando">Guardar Cambios</span>
                <span *ngIf="guardando">Guardando...</span>
              </ion-button>

              <ion-button expand="block" fill="outline" color="medium" (click)="cancelarEdicion()">
                <ion-icon name="close" slot="start"></ion-icon>
                Cancelar
              </ion-button>
            </div>

           

          </div>
        </form>

      </ion-content>
    </ng-template>
  </ion-modal>


</ion-content>